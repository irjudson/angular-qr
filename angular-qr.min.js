/*!
 * angular-qr v0.1.4
 * The MIT License
 * Copyright (c) 2014 Jan Antala <hello@janantala.com>
 */

!function(t){"use strict";angular.module("ja.qr",[]).controller("QrCtrl",["$scope",function(t){t.getTypeNumeber=function(){return t.typeNumber||0},t.getCorrection=function(){var e={L:1,M:0,Q:3,H:2},n=t.correctionLevel||0;return e[n]||0},t.getText=function(){return t.text||""},t.getSize=function(e){var n,r,i=100;return window.innerHeight>e.parentElement.offsetHeight?(n=window.innerHeight-i,r=window.innerWidth):(n=e.parentElement.offsetHeight-i,r=e.parentElement.offsetWidth),n>r?t.size||r:t.size||n},t.isNUMBER=function(t){var e=/^[0-9]*$/;return e.test(t)},t.isALPHA_NUM=function(t){var e=/^[0-9A-Z $%*+\-./:]*$/;return e.test(t)},t.is8bit=function(t){for(var e=0;e<t.length;e++){var n=t.charCodeAt(e);if(n>255)return!1}return!0},t.checkInputMode=function(e,n){if("NUMBER"===e&&!t.isNUMBER(n))throw new Error("The `NUMBER` input mode is invalid for text.");if("ALPHA_NUM"===e&&!t.isALPHA_NUM(n))throw new Error("The `ALPHA_NUM` input mode is invalid for text.");if("8bit"===e&&!t.is8bit(n))throw new Error("The `8bit` input mode is invalid for text.");if(!t.is8bit(n))throw new Error("Input mode is invalid for text.");return!0},t.getInputMode=function(e){var n=t.inputMode;return n=n||(t.isNUMBER(e)?"NUMBER":void 0),n=n||(t.isALPHA_NUM(e)?"ALPHA_NUM":void 0),n=n||(t.is8bit(e)?"8bit":""),t.checkInputMode(n,e)?n:""}}]).directive("qr",["$timeout","$window",function(e,n){return{restrict:"E",template:"<canvas></canvas>",scope:{typeNumber:"@",correctionLevel:"@",inputMode:"@",size:"@",text:"@"},controller:"QrCtrl",link:function(r,i){if(void 0===r.text)throw new Error("The `text` attribute is required.");var o=i.find("canvas")[0],E=!!n.CanvasRenderingContext2D;r.TYPE_NUMBER=r.getTypeNumeber(),r.TEXT=r.getText(),r.CORRECTION=r.getCorrection(),r.SIZE=r.getSize(o),r.INPUT_MODE=r.getInputMode(r.TEXT);var u=function(t,e,n,r){for(var i=0;n>i;i++)for(var o=0;n>o;o++){var E=Math.ceil((o+1)*r)-Math.floor(o*r),u=Math.ceil((i+1)*r)-Math.floor(i*r);t.fillStyle=e.isDark(i,o)?"#000":"#fff",t.fillRect(Math.round(o*r),Math.round(i*r),E,u)}},T=function(e,n,r,i,o,T){var c=/^\s+|\s+$/g,a=n.replace(c,""),f=new t(r,i,T);f.addData(a),f.make();var M=e.getContext("2d"),N=f.getModuleCount(),d=o/N;e.width=e.height=o,E&&u(M,f,N,d)};T(o,r.TEXT,r.TYPE_NUMBER,r.CORRECTION,r.SIZE,r.INPUT_MODE),e(function(){r.$watch("text",function(t,e){t!==e&&(r.TEXT=r.getText(),r.INPUT_MODE=r.getInputMode(r.TEXT),T(o,r.TEXT,r.TYPE_NUMBER,r.CORRECTION,r.SIZE,r.INPUT_MODE))}),r.$watch("correctionLevel",function(t,e){t!==e&&(r.CORRECTION=r.getCorrection(),T(o,r.TEXT,r.TYPE_NUMBER,r.CORRECTION,r.SIZE,r.INPUT_MODE))}),r.$watch("typeNumber",function(t,e){t!==e&&(r.TYPE_NUMBER=r.getTypeNumeber(),T(o,r.TEXT,r.TYPE_NUMBER,r.CORRECTION,r.SIZE,r.INPUT_MODE))}),r.$watch("size",function(t,e){t!==e&&(r.SIZE=r.getSize(),T(o,r.TEXT,r.TYPE_NUMBER,r.CORRECTION,r.SIZE,r.INPUT_MODE))}),r.$watch("inputMode",function(t,e){t!==e&&(r.INPUT_MODE=r.getInputMode(r.TEXT),T(o,r.TEXT,r.TYPE_NUMBER,r.CORRECTION,r.SIZE,r.INPUT_MODE))})})}}}])}(window.QRCode);